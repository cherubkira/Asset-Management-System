{% extends "asset1/base.html" %}
{% load static %} 
{% load widget_tweaks %}

{% block content %}
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<div class="min-h-screen w-full bg-gray-50">

    <aside id="sidebar"
       class="bg-gray-200 min-h-screen fixed top-0 left-0 flex-shrink-0 overflow-y-auto transition-all duration-300 z-50"
       " style="width: 16rem;">

        <div class="flex flex-col justify-between h-full">

            <div class="flex flex-col gap-2 p-4">
               
            <div class="mb-4">
                
                <img src="{% static 'images/asset.png' %}" alt="Asset Management Logo" class="h-12 mx-auto">
            </div>
                <a href="{% url 'asset1:dashboard' %}" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-300">
                    <i class="fas fa-home w-5"></i>
                    <span class="sidebar-text">Dashboard</span>
                </a>
                <a href="{% url 'asset1:asset_list' %}" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-300">
                    <i class="fas fa-box w-5"></i>
                    <span class="sidebar-text">Asset</span>
                </a>
                <a href="{% url 'asset1:employee_list' %}" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-300">
                    <i class="fas fa-users w-5"></i>
                    <span class="sidebar-text">User Management</span>
                </a>
                <a href="{% url 'asset1:asset_history' %}" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-300">
                    <i class="fas fa-clock w-5"></i>
                    <span class="sidebar-text">Asset History</span>
                </a>
                <a href="{% url 'asset1:asset_category' %}" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-300">
                    <i class="fas fa-tags w-5"></i>
                    <span class="sidebar-text">Asset Category</span>
                </a>
                <a href="{% url 'asset1:subcategory_list' %}" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-300">
                    <i class="fas fa-puzzle-piece w-5"></i>
                    <span class="sidebar-text">Sub Category</span>
                </a>
                <a href="{% url 'asset1:asset_status' %}" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-300">
                    <i class="fas fa-check-circle w-5"></i>
                    <span class="sidebar-text">Asset Status</span>
                </a>

                <details class="group">
                    <summary class="flex justify-between items-center px-3 py-2 rounded cursor-pointer hover:bg-gray-300">
                        <span>
                            <i class="fas fa-envelope w-5"></i>
                            <span class="sidebar-text">Request Module</span>
                        </span>
                        <i class="fas fa-chevron-down transition-transform group-open:rotate-180"></i>
                    </summary>
                    <div class="pl-6 mt-1 flex flex-col gap-1">
                        <a href="{% url 'asset1:asset_request_list' %}" class="px-2 py-1 rounded hover:bg-gray-300 sidebar-text">Asset Request</a>
                        <a href="{% url 'asset1:asset_issue_list' %}" class="px-2 py-1 rounded hover:bg-gray-300 sidebar-text">Asset Issue</a>
                    </div>
                </details>

                <details class="group">
                    <summary class="flex justify-between items-center px-3 py-2 rounded cursor-pointer hover:bg-gray-300">
                        <span>
                            <i class="fas fa-chart-bar w-5"></i>
                            <span class="sidebar-text">Report</span>
                        </span>
                        <i class="fas fa-chevron-down transition-transform group-open:rotate-180"></i>
                    </summary>
                    <div class="pl-6 mt-1 flex flex-col gap-1">
                        <a href="#" class="px-2 py-1 rounded hover:bg-gray-300 sidebar-text">Asset Info</a>
                        <a href="#" class="px-2 py-1 rounded hover:bg-gray-300 sidebar-text">Asset Allocation</a>
                    </div>
                </details>
            </div>
        </div>
    </aside>

    <nav id="navbar"
     class="bg-white shadow flex justify-between items-center px-10 h-20 flex-shrink-0 fixed top-0 z-40 transition-all duration-300"
     style="height: 4.75rem; left: 16rem; width: calc(100vw - 16rem);">
        
        <div class="flex items-center gap-4">
            <button id="sidebar-toggle"
                    class="p-2 rounded bg-gray-100 hover:bg-gray-200 transition">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>

        <div class="relative flex items-center" id="user-dropdown-container">
            <button id="user-dropdown-btn" class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition select-none">
                <div class="h-10 w-10 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center">
                    <img id="user-avatar" src="" alt="User" class="object-cover w-full h-full">
                </div>
                <div class="flex flex-col leading-tight text-left sidebar-text">
                    <span class="text-gray-800 dark:text-gray-100 font-semibold text-sm">{{ user.get_username }}</span>
                </div>
                <i id="user-dropdown-icon" class="fas fa-chevron-down text-gray-500 ml-2 transition-transform duration-200"></i>
            </button>
            
            <div id="user-dropdown-menu" class="absolute right-0 mt-2 w-60 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hidden opacity-0 translate-y-2 transition-all duration-200 z-50">
                <ul class="flex flex-col p-2 text-sm">
                    <li>
                        <form method="post" action="{% url 'asset1:logout' %}">
                            {% csrf_token %}
                            <button type="submit" class="w-full text-left flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                                <i class="fas fa-sign-out-alt w-4"></i> Logout
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
 <main id="main-content"
      class="overflow-y-auto p-6 bg-gray-50 transition-all duration-300"
      style="margin-left: 16rem; margin-top: 5rem; min-height: calc(100vh - 5rem);">
    {% block page_content %}{% endblock %}
</main>


</div>


<script>
    const sidebar = document.getElementById("sidebar");
    const toggleBtn = document.getElementById("sidebar-toggle");
    const mainContent = document.getElementById("main-content");
    const navbar = document.getElementById("navbar");


    // Define widths in rem 
    const sidebarWidthExpanded = '16rem';
    const sidebarWidthCollapsed = '4.5rem';
    
    sidebar.classList.add("expanded");

    toggleBtn.addEventListener("click", () => {
        
        const isExpanded = sidebar.classList.toggle("expanded");

        let targetWidth, targetMargin;

        if (isExpanded) {
            
            targetWidth = sidebarWidthExpanded;
            targetMargin = sidebarWidthExpanded;

        } else {
            
            targetWidth = sidebarWidthCollapsed;
            targetMargin = sidebarWidthCollapsed;
        }
        
        
        sidebar.style.width = targetWidth; 
        navbar.style.left = targetWidth; 
        navbar.style.width = `calc(100vw - ${targetWidth})`;
        mainContent.style.marginLeft = targetMargin; 
        
        
        document.querySelectorAll(".sidebar-text").forEach(el => {
            el.classList.toggle("hidden");
        });
    });
</script>





<script>

const username = "{{ user.get_username }}";
const avatar = document.getElementById("user-avatar");

if (!avatar.src || avatar.src.trim() === "") {
    const initials = username
        .split(" ")
        .map(n => n[0].toUpperCase())
        .join("");

    const bgColor = "#4f46e5";
    const textColor = "white";

    const svg = `
        <svg xmlns='http://www.w3.org/2000/svg' width='100' height='100'>
            <rect width='100' height='100' fill='${bgColor}' />
            <text x='50%' y='55%' font-size='40'
                  text-anchor='middle' fill='${textColor}'
                  font-family='Arial' dy='.1em'>${initials}</text>
        </svg>
    `;
    avatar.src = "data:image/svg+xml;base64," + btoa(svg);
}

const btn = document.getElementById("user-dropdown-btn");
const menu = document.getElementById("user-dropdown-menu");
const icon = document.getElementById("user-dropdown-icon");

btn.addEventListener("click", () => {
    menu.classList.toggle("hidden");
    menu.classList.toggle("opacity-0");
    menu.classList.toggle("translate-y-2");
    icon.classList.toggle("rotate-180");
});

// Close dropdown when clicking outside
document.addEventListener("click", (e) => {
    const container = document.getElementById("user-dropdown-container");

    if (!container.contains(e.target)) {
        menu.classList.add("hidden", "opacity-0", "translate-y-2");
        icon.classList.remove("rotate-180");
    }
});
</script>

{% endblock %}