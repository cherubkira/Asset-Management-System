{% extends "asset1/sidebar.html" %}
{% load static %}

{% block page_content %}

<div class="pt-20">

  <!-- Dashboard Cards -->
<div class="flex flex-wrap gap-4">

  <!-- Total Assets -->
  <div class="flex-1 min-w-[12rem]">
    <div class="bg-blue-600 text-white rounded shadow p-4 flex items-center justify-between">
      <div>
        <h5 class="font-medium text-sm uppercase opacity-75">Total Assets</h5>
        <h3 class="text-3xl font-bold">{{ total_assets }}</h3>
      </div>
      <!-- Icon on the right side -->
      <i class="bi bi-bank text-5xl opacity-50"></i>
    </div>
  </div>

  <!-- Available -->
  <div class="flex-1 min-w-[12rem]">
    <div class="bg-green-600 text-white rounded shadow p-4 flex items-center justify-between">
      <div>
        <h5 class="font-medium text-sm uppercase opacity-75">Available</h5>
        <h3 class="text-3xl font-bold">{{ available }}</h3>
      </div>
      <!-- Icon on the right side -->
      <i class="bi bi-check2-circle text-5xl opacity-50"></i>
    </div>
  </div>

  <!-- Assigned -->
  <div class="flex-1 min-w-[12rem]">
    <div class="bg-yellow-400 text-gray-900 rounded shadow p-4 flex items-center justify-between">
      <div>
        <h5 class="font-medium text-sm uppercase opacity-75">Assigned</h5>
        <h3 class="text-3xl font-bold">{{ assigned }}</h3>
      </div>
      <!-- Icon on the right side -->
      <i class="bi bi-people-fill text-5xl opacity-50"></i>
    </div>
  </div>

  <!-- Maintenance -->
  <div class="flex-1 min-w-[12rem]">
    <div class="bg-red-600 text-white rounded shadow p-4 flex items-center justify-between">
      <div>
        <h5 class="font-medium text-sm uppercase opacity-75">Maintenance</h5>
        <h3 class="text-3xl font-bold">{{ maintenance }}</h3>
      </div>
      <!-- Icon on the right side -->
      <i class="bi bi-gear-fill text-5xl opacity-50"></i>
    </div>
  </div>
</div>

<div class="flex flex-wrap gap-8 mt-10">

  
  <div class="flex-1 min-w-[300px] md:w-[calc(50%-1rem)] bg-white rounded-lg shadow p-4 sm:p-6">
    <h2 class="text-2xl font-bold mb-4">Recent Assignments</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-200 rounded-lg">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Asset ID</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Asset Name</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">From</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">To</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Assigned At</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for a in recent_assignments %}
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-2 text-center whitespace-nowrap">{{ a.asset.id }}</td>
            <td class="px-4 py-2 whitespace-nowrap">{{ a.asset.name }}</td>
            <td class="px-4 py-2 whitespace-nowrap">{{ a.assigned_from }}</td>
            <td class="px-4 py-2 whitespace-nowrap">{{ a.assigned_to }}</td>
            <td class="px-4 py-2 whitespace-nowrap">{{ a.created_at }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center py-6 text-gray-500">No assignments yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recent Users Table -->
  <div class="flex-1 min-w-[300px] md:w-[calc(50%-1rem)] bg-white rounded-lg shadow p-4 sm:p-6">
    <h2 class="text-2xl font-bold mb-4">Recent Registered Users</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-200 rounded-lg">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Profile ID</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Picture</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Name</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Phone Number</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600 whitespace-nowrap">Email</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for user in employees %}
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-2 text-center whitespace-nowrap">{{ user.id }}</td>
            <td class="px-4 py-2 text-center">
              {% if user.img %}
              <img src="{{ user.img.url }}" class="w-10 h-10 rounded-full mx-auto object-cover" alt="User Image" />
              {% else %}
              <img src="{% static 'images/default_profile.png' %}" class="w-10 h-10 rounded-full mx-auto object-cover" alt="Default Profile Image" />
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">{{ user.first_name }} {{ user.last_name }}</td>
            <td class="px-4 py-2 whitespace-nowrap">{{ user.phone_number }}</td>
            <td class="px-4 py-2 whitespace-nowrap">{{ user.email }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center py-6 text-gray-500">No recent users found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>



  <!-- Asset Pie Chart -->
  <div class="mt-6 bg-white rounded shadow p-4">
    <h6 class="text-blue-700 font-semibold mb-2">Asset Allocation Summary</h6>
    <div class="max-w-md mx-auto">
      <canvas id="assetPieChart" class="w-full h-64"></canvas>
      <div class="text-center mt-2">Assigned: {{ assigned_percentage }} %</div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const assignedDataEl = document.getElementById("assigned-data");
const availableDataEl = document.getElementById("available-data");

if(assignedDataEl && availableDataEl) {
  const assetData = {
    assigned: JSON.parse(assignedDataEl.textContent),
    unassigned: JSON.parse(availableDataEl.textContent)
  };

  const ctx = document.getElementById("assetPieChart").getContext("2d");
  new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Assigned", "Unassigned"],
      datasets: [{
        data: [assetData.assigned, assetData.unassigned],
        backgroundColor: ["#4e73df", "#1cc88a"],
        hoverBackgroundColor: ["#2e59d9", "#17a673"],
        hoverBorderColor: "rgba(234,236,244,1)"
      }]
    },
    options: {
      maintainAspectRatio: false,
      plugins: {
        tooltip: {
          backgroundColor: "#fff",
          titleColor: "#333",
          bodyColor: "#333",
          borderColor: "#ddd",
          borderWidth: 1,
          padding: 8,
          displayColors: false
        },
        legend: { display: false }
      }
    }
  });
}
</script>

<style>
/* Ensure no horizontal scroll on body */
html, body { overflow-x: hidden; }
</style>

{% endblock %}
