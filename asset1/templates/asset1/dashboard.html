{% extends "asset1/sidebar.html" %}
{% load static %}

{% block page_content %}

<!-- Dashboard Cards -->
<div class="flex flex-wrap -mx-2 mt-2">

  <!-- Total Assets -->
  <div class="w-1/4 px-2 mb-4">
    <div class="bg-blue-600 text-white rounded shadow p-4 text-center">
      <i class="bi bi-bank text-4xl mb-2"></i>
      <h5 class="font-medium">Total Assets</h5>
      <h3 class="text-2xl font-bold">{{ total_assets }}</h3>
    </div>
  </div>

  <!-- Available -->
  <div class="w-1/4 px-2 mb-4">
    <div class="bg-green-600 text-white rounded shadow p-4 text-center">
      <i class="bi bi-check2-circle text-4xl mb-2"></i>
      <h5 class="font-medium">Available</h5>
      <h3 class="text-2xl font-bold">{{ available }}</h3>
    </div>
  </div>

  <!-- Assigned -->
  <div class="w-1/4 px-2 mb-4">
    <div class="bg-yellow-400 text-gray-900 rounded shadow p-4 text-center">
      <i class="bi bi-people-fill text-4xl mb-2"></i>
      <h5 class="font-medium">Assigned</h5>
      <h3 class="text-2xl font-bold">{{ assigned }}</h3>
    </div>
  </div>

  <!-- Pending Requests -->
  <div class="w-1/4 px-2 mb-4">
    <div class="bg-red-600 text-white rounded shadow p-4 text-center">
      <i class="bi bi-person-lines-fill text-4xl mb-2"></i>
      <h5 class="font-medium">Pending Requests</h5>
      <h3 class="text-2xl font-bold">{{ pending_requests }}</h3>
    </div>
  </div>
</div>

<!-- Recent Assignments Table -->
<h4 class="mt-6 mb-2 text-lg font-semibold">Recent Assignments</h4>
<div class="overflow-x-auto">
  <table class="min-w-full bg-white border rounded shadow">
    <thead class="bg-gray-800 text-white">
      <tr>
        <th class="py-2 px-3 text-left">Asset ID</th>
        <th class="py-2 px-3 text-left">Asset Name</th>
        <th class="py-2 px-3 text-left">From</th>
        <th class="py-2 px-3 text-left">To</th>
        <th class="py-2 px-3 text-left">At</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
      {% for a in recent_assignments %}
      <tr class="hover:bg-gray-100">
        <td class="py-2 px-3">{{ a.asset.id }}</td>
        <td class="py-2 px-3">{{ a.asset.name }}</td>
        <td class="py-2 px-3">{{ a.assigned_from }}</td>
        <td class="py-2 px-3">{{ a.assigned_to }}</td>
        <td class="py-2 px-3">{{ a.created_at }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="py-2 px-3 text-center text-gray-500">No assignments yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Recent Users Table -->
<h4 class="mt-6 mb-2 text-lg font-semibold">Recent Registered Users</h4>
<div class="overflow-x-auto">
  <table class="min-w-full bg-white border rounded shadow">
    <thead class="bg-gray-800 text-white">
      <tr>
        <th class="py-2 px-3">Profile ID</th>
        <th class="py-2 px-3">Profile Picture</th>
        <th class="py-2 px-3">First Name</th>
        <th class="py-2 px-3">Last Name</th>
        <th class="py-2 px-3">Phone Number</th>
        <th class="py-2 px-3">Email</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
      {% for user in recent_users %}
      <tr class="hover:bg-gray-100">
        <td class="py-2 px-3">{{ user.profile_id }}</td>
        <td class="py-2 px-3">
          {% if user.profile_picture %}
            <img src="{{ user.profile_picture.url }}" class="w-8 h-8 rounded-full">
          {% else %}
            <img src="{% static 'img/default_profile.png' %}" class="w-8 h-8 rounded-full">
          {% endif %}
        </td>
        <td class="py-2 px-3">{{ user.first_name }}</td>
        <td class="py-2 px-3">{{ user.last_name }}</td>
        <td class="py-2 px-3">{{ user.phone_number }}</td>
        <td class="py-2 px-3">{{ user.email }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="py-2 px-3 text-center text-gray-500">No recent users found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Asset Allocation Pie Chart -->
<div class="bg-white rounded shadow mt-6 p-4">
  <h6 class="text-blue-700 font-semibold mb-2">Asset Allocation Summary</h6>
  <div class="max-w-md mx-auto">
    <canvas id="assetPieChart" class="w-full h-64"></canvas>
    <div class="text-center mt-2">Assigned: {{ assigned_percentage }} %</div>
  </div>
</div>

{% endblock page_content %}

{% block scripts %}
{{ assigned|default:0|json_script:"assigned-data" }}
{{ available|default:0|json_script:"available-data" }}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const assetData = {
    assigned: JSON.parse(document.getElementById('assigned-data').textContent),
    unassigned: JSON.parse(document.getElementById('available-data').textContent),
};

const ctx = document.getElementById('assetPieChart').getContext('2d');
new Chart(ctx, {
    type: 'pie',
    data: {
        labels: ['Assigned', 'Unassigned'],
        datasets: [{
            data: [assetData.assigned, assetData.unassigned],
            backgroundColor: ['#4e73df', '#1cc88a'],
            hoverBackgroundColor: ['#2e59d9', '#17a673'],
            hoverBorderColor: "rgba(234, 236, 244, 1)",
        }],
    },
    options: {
        maintainAspectRatio: false,
        plugins: {
            tooltip: {
                backgroundColor: "#fff",
                titleColor: "#333",
                bodyColor: "#333",
                borderColor: '#ddd',
                borderWidth: 1,
                padding: 8,
                displayColors: false,
            },
            legend: { display: false }
        }
    },
});
</script>
{% endblock scripts %}
